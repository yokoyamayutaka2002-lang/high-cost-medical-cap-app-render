# High-cost-medical-app

このリポジトリは高額療養費に関する計算のサンプルです。

用語定義

- イベント（event）  
  1回の処方・投与を表す論理的単位。  
  スケジュール生成における最小の時系列要素。

- 処方本数（prescribed_units）  
  次イベントまでに進む投与間隔を決定する単位数。  
  実際の投与可否や保険算定とは独立した、純粋なスケジューリング用概念。

- 自動処方（auto）  
  user input を介さず、drug_rule によって決定される処方割付。  
  UI 上では編集不可または自動扱いとして表示される。
````
 
## 生物学的製剤 薬価抽出パイプライン（補記）

以下は `data/biologic_drug_master_exact.csv` と補助スクリプトに関する、
最小限の運用追記です（既存本文は変更していません）。

- `exact_item_name` は原則としてExcelの品名セルをそのままコピー＆ペーストする。
  貼付後は先頭/末尾の半角・全角空白・制御文字を除去するが、文字列自体の改変（省略・置換）は行わない。
  変更が必要な場合は原文を残す列（例：`original_name`）を保持すること。

原則 `route` は `injection` とする。`iv` または `sc` に分けるのは、参照Excelの該当行で明確に
「静注」「皮下注」の別が記載され、かつマスター集計単位として分割する必要があると
合意された場合のみ行う。

`find_exact_in_injection.py` はあくまで手動検証用の補助ツールであり、
マスター編集時に1件ずつ照合するために使う。自動処理の一部として本ツールを組み込まないこと（検証専用）。

`WARN: not found in Excel: <name>` は表記ミスマッチまたは未登録のシグナルとみなす。
WARN が出た行は直ちに自動登録せず、全角/半角、空白、規格差などを確認したうえで
マスターを修正・再検証すること。

品名／薬価列が検出できない場合は処理を停止してエラーとし、
対象Excel名・シート名をログに残す。手動で列名を確認・修正してから再実行すること。

同一の `exact_item_name` が複数行存在する場合は、意図的な規格分離でない限りエラー扱いとする。
編集者が重複の意図を確認し、修正または統合を行うこと。

本パイプラインは薬価抽出（exact match）専用であり、
投与スケジュール、用量計算、体重補正、IgE 等の臨床指標に基づく処理は実施しない。

````

## Local run (Windows PowerShell)

```powershell
cd C:\dev\High-cost-medical-cap-app-Ver1
$env:PYTHONPATH = (Get-Location).Path
python webapp/app.py
```

python src\calculator.py
```
 
## 7. 将来の開発者への注意（警告）

この設計を破る変更（例: generate_schedule 内での条件分岐追加）は、
必ず設計レビュー（Architecture Decision Record）を経て合意を得ること。

## 生物学的製剤 薬価抽出パイプライン（補記）

以下は `data/biologic_drug_master_exact.csv` と補助スクリプトに関する、
最小限の運用追記です（既存本文は変更していません）。

- `exact_item_name` は原則としてExcelの品名セルをそのままコピー＆ペーストする。
  貼付後は先頭/末尾の半角・全角空白・制御文字を除去するが、文字列自体の改変（省略・置換）は行わない。
  変更が必要な場合は原文を残す列（例：`original_name`）を保持すること。

原則 `route` は `injection` とする。`iv` または `sc` に分けるのは、参照Excelの該当行で明確に
「静注」「皮下注」の別が記載され、かつマスター集計単位として分割する必要があると
合意された場合のみ行う。

`find_exact_in_injection.py` はあくまで手動検証用の補助ツールであり、
マスター編集時に1件ずつ照合するために使う。自動処理の一部として本ツールを組み込まないこと（検証専用）。

`WARN: not found in Excel: <name>` は表記ミスマッチまたは未登録のシグナルとみなす。
WARN が出た行は直ちに自動登録せず、全角/半角、空白、規格差などを確認したうえで
マスターを修正・再検証すること。

品名／薬価列が検出できない場合は処理を停止してエラーとし、
対象Excel名・シート名をログに残す。手動で列名を確認・修正してから再実行すること。

同一の `exact_item_name` が複数行存在する場合は、意図的な規格分離でない限りエラー扱いとする。
編集者が重複の意図を確認し、修正または統合を行うこと。

本パイプラインは薬価抽出（exact match）専用であり、
投与スケジュール、用量計算、体重補正、IgE 等の臨床指標に基づく処理は実施しない。

````
